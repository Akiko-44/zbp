<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv='X-UA-Compatible' content='IE=Edge,chrome=1' />
<meta name="renderer" content="webkit">
<meta name="description" content="">
<meta name="keywords" content="">
<title><%= title %></title>
<link rel="shortcut icon" type="image/x-icon" href="../../dist/img/favicon.ico"/>
<link rel="bookmark" type="image/x-icon" href="../../dist/img/favicon.ico"/>
<link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_718775_m854kdemp1s.css"/>
<link rel="stylesheet" type="text/css" href="../../src/css/sprite.css"/>
<link rel="stylesheet" type="text/css" href="../../dist/css/all.css"/>
<link rel="stylesheet" type="text/css" href="../../src/js/vue/index.css"/>
<script src="../../dist/js/template.js"></script>
<script src="../../dist/js/lib.js"></script>
<script src="../../dist/js/v.js"></script>
<script src="../../src/js/address.js"></script>
</head>
<body class="userOrderJewelry">
	
	<%- include ../../headerbar.ejs %>
	
	<%- include ../../header.ejs %>
	
	<%- include ../userHeaderNav.ejs %>
	
	<div class="container">
		<div class="router" id="router">
			<el-breadcrumb separator-class="el-icon-arrow-right">
			  	<el-breadcrumb-item :to="{ path: '/' }">首页</el-breadcrumb-item>
			  	<el-breadcrumb-item>个人中心</el-breadcrumb-item>
			</el-breadcrumb>
		</div>
	</div>
	
	<div id="main" class="main">
		<div class="clearfix container">
			<div class="userLeftNav">
				<%- include ../userLeftNav.ejs %>
			</div>
			<div class="userRightContent">
				
				<div id="orderDetail">
					
					<div id="orderProgress">
						<ul class="clearfix">
							<template v-if="data.state==8">
							<li class="cur">
								<h4>待确认</h4>
								<span>1</span>
							</li>
							<li class="cur">
								<h4>交易取消</h4>
								<span>2</span>
							</li>
							</template>
							<template v-else>
							<li>
								<h4>待确认</h4>
								<span>1</span>
							</li>
							<li>
								<h4>待付款</h4>
								<span>2</span>
							</li>
							<li>
								<h4>待发货</h4>
								<span>3</span>
							</li>
							<li>
								<h4>待收货</h4>
								<span>4</span>
							</li>
							<li>
								<h4>交易成功</h4>
								<span>5</span>
							</li>
							</template>
							
						</ul>
					</div>
					
					<div class="orderInfo">
						<div class="panel userPanel">
							<div class="panel-header">
								<h3 class="panel-title">
									<b style="margin-right: 20px">{{data.createTime}}</b>
									<span>
										订单编号：{{data.orderNumber}}
									</span>
								</h3>
							</div>
							<div class="panel-body">
								<table>
									<tr>
										<td width="330" valign="top" style="padding-right: 20px;">
											<h3>交换方信息</h3>
											<p>
												<label>联系人：</label>
												<span v-if="!!data.swapInUserVO">{{data.swapInUserVO.username}}</span>
											</p>
											<p>
												<label>所在地：</label>
												<span v-if="!!data.swapInUserVO">{{data.swapInUserVO.shippingAddr}}</span>
											</p>
											<!--<p>
												<label>QQ号：</label>
												<span v-if="!!data.swapInUserVO"></span>
											</p>-->
											<p>
												<label>手机号码：</label>
												<span v-if="!!data.swapInUserVO">{{data.swapInUserVO.mobile}}</span>
											</p>
											<!--<p>
												<label>微信号：</label>
												<span v-if="!!data.swapInUserVO"></span>
											</p>-->
											<p>
												<label>收货地址：</label>
												<span v-if="!!data.swapInUserVO">{{data.swapInUserVO.addr}}</span>
											</p>
										</td>
										<td valign="top" style="border-left: 1px dashed #eaeaea;padding: 0 30px;">
											<h3>订单状态：</h3>
											<template>
												<p v-if="data.state == 1"></p>
												<p v-else-if="data.state == 2"></p>
												<p v-else-if="data.state == 3"></p>
												<p v-else-if="data.state == 4"></p>
												<p v-else-if="data.state == 5"></p>
												<p v-else-if="data.state == 6"></p>
												<p v-else-if="data.state == 7">已完成</p>
												<p v-else-if="data.state == 8">已取消</p>
												<p v-else-if="data.state == 9">已关闭</p>
												<p v-else-if="data.state == 10"></p>
												<p v-else-if="data.state == 11"></p>
												<p v-else-if="data.state == 12"></p>
												<p v-else-if="data.state == 13"></p>
												<p v-else-if="data.state == 14"></p>
												<p v-else-if="data.state == 15"></p>
												<p v-else-if="data.state == 16"></p>
											</template>
											<template>
												<p v-if="data.swapoutState == 41"></p>
												<p v-else-if="data.swapoutState == 42">我方未支付保证金</p>
												<p v-else-if="data.swapoutState == 43"></p>
												<p v-else-if="data.swapoutState == 44">我方已支付保证金</p>
												<p v-else-if="data.swapoutState == 45">我方待发货</p>
												<p v-else-if="data.swapoutState == 46"></p>
												<p v-else-if="data.swapoutState == 47">我方已发货</p>
												<p v-else-if="data.swapoutState == 48">我方待收货</p>
												<p v-else-if="data.swapoutState == 49"></p>
												<p v-else-if="data.swapoutState == 50">我方已收货</p>
											</template>
											<template>
												<p v-if="data.swapinState == 41"></p>
												<p v-else-if="data.swapinState == 42">对方未支付保证金</p>
												<p v-else-if="data.swapinState == 43">对方已支付保证金</p>
												<p v-else-if="data.swapinState == 44"></p>
												<p v-else-if="data.swapinState == 45">对方待发货</p>
												<p v-else-if="data.swapinState == 46">对方已发货</p>
												<p v-else-if="data.swapinState == 47"></p>
												<p v-else-if="data.swapinState == 48">对方待收货</p>
												<p v-else-if="data.swapinState == 49">对方已收货</p>
												<p v-else-if="data.swapinState == 50"></p>
											</template>
											
											<p>
												<label>保证金：</label>
												<span>{{data.goodsTotalMoney}}</span>
											</p>
											
											<div>
												<template v-if="data.state != 8 && data.swapoutState < 47">
													<p v-if="data.swapinState == 42 || data.swapinState == 43 || data.swapinState == 45">
														<a class="blue cancelOrderBtn" :orderNumber="data.orderNumber">取消订单</a>
													</p>
												</template>
												<template v-if="data.state != 8 && data.swapoutState == 41">
													<a class="btn btn-warning toAgreeOrderBtn" :orderNumber="data.orderNumber">确认交换</a>
												</template>
												<template v-if="data.state != 8 && data.swapoutState == 42">
													<a class="btn btn-warning toPayOrderBtn" :orderNumber="data.orderNumber">支付保证金</a>
												</template>
												<template v-if="data.state != 8 && data.swapinState >= 43 && data.swapoutState == 44">
													<a class="btn btn-warning sendOrderBtn" :orderNumber="data.orderNumber">发货</a>
												</template>
												<template v-if="data.swapinState >= 46 && data.swapoutState == 47">
													<a class="btn btn-warning receiveOrderBtn" :orderNumber="data.orderNumber">确认收货</a>
												</template>
											</div>
												
										</td>
									</tr>
								</table>
							</div>
						</div>
					</div>
					
					<div class="goodsList">
						<div class="panel userPanel">
							<div class="panel-header">
								<h3 class="panel-title"><b>交换商品</b></h3>
							</div>
							<div class="panel-body">
								<table>
									<thead>
										<tr class="tc">
											<th colspan="2">主图</th>
											<th>商品信息</th>
											<th>单价</th>
											<th>数量</th>
										</tr>
									</thead>
									<tbody>
										<template v-if="data.swapOutList && data.swapOutList.length>0">
										<tr v-for="item in data.swapOutList">
											<td width="120">
												<img :src="item.skuMainPic | formatImg" width="100" height="100">
											</td>
											<td>
												<h3>{{item.skuName}}</h3>
												<p>{{item.skuExplain}}</p>
											</td>
											<td class="tc">￥{{item.unitPrice}}</td>
											<td class="tc">{{item.goodsNumber}}</td>
										</tr>
										</template>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					
					<div class="payInfo" v-if="data.state!=1">
						<div class="panel userPanel">
							<div class="panel-header">
								<h3 class="panel-title"><b>交换方支付信息</b></h3>
							</div>
							<div class="panel-body">
								<table>
									<tr>
										<td width="45%">
											<label>支付方式：</label>
											<span>在线支付</span>
										</td>
										<td>
											<label>支付渠道：</label>
											<span>{{g_const.payType[data.payType]}}</span>
										</td>
									</tr>
									<tr>
										<td width="45%">
											<label>支付流水号：</label>
											<span></span>
										</td>
										<td>
											<label>创建时间：</label>
											<span>{{data.createTime}}</span>
										</td>
									</tr>
								</table>
							</div>
						</div>
					</div>
					
					<template v-if="data.state != 8">
					<div class="expressInfo">
						<div class="panel userPanel">
							<div class="panel-header">
								<div class="panel-control">
									<a :orderId="data.orderNumber" class="blue expressOrderBtn0">查看物流</a>
								</div>
								<h3 class="panel-title"><b>交换方物流信息</b></h3>
							</div>
							<div class="panel-body">
								<table>
									<tr>
										<td width="33%">
											<label>快递公司：</label>
											<span v-if="data.orderExpressIn">{{data.orderExpressIn.expressCompany}}</span>
										</td>
										<td width="33%">
											<label>快递单号：</label>
											<span v-if="data.orderExpressIn">{{data.orderExpressIn.expressNum}}</span>
										</td>
										<td>
											<label>时间：</label>
											<span v-if="data.orderExpressIn">{{data.orderExpressIn.createTime}}</span>
										</td>
									</tr>
								</table>
							</div>
						</div>
					</div>
					</template>
					
					<div class="goodsList">
						<div class="panel userPanel">
							<div class="panel-header">
								<h3 class="panel-title"><b>我的商品</b></h3>
							</div>
							<div class="panel-body">
								<table>
									<thead>
										<tr class="tc">
											<th colspan="2">主图</th>
											<th>商品信息</th>
											<th>单价</th>
											<th>数量</th>
										</tr>
									</thead>
									<tbody>
										<tr v-if="!!data.swapIn">
											<td width="120">
												<img :src="data.swapIn.skuMainPic | formatImg" width="100" height="100">
											</td>
											<td>
												<h3>{{data.swapIn.skuName}}</h3>
												<p></p>
											</td>
											<td class="tc">￥{{data.swapIn.unitPrice}}</td>
											<td class="tc">{{data.swapIn.goodsNumber}}</td>
										</tr>
										
									</tbody>
								</table>
							</div>
						</div>
					</div>
					
					<div class="payInfo" v-if="data.state!=1">
						<div class="panel userPanel">
							<div class="panel-header">
								<h3 class="panel-title"><b>我的支付信息</b></h3>
							</div>
							<div class="panel-body">
								<table>
									<tr>
										<td width="45%">
											<label>支付方式：</label>
											<span>在线支付</span>
										</td>
										<td>
											<label>支付渠道：</label>
											<span>{{g_const.payType[data.payType]}}</span>
										</td>
									</tr>
									<tr>
										<td width="45%">
											<label>支付流水号：</label>
											<span></span>
										</td>
										<td>
											<label>创建时间：</label>
											<span>{{data.createTime}}</span>
										</td>
									</tr>
								</table>
							</div>
						</div>
					</div>
					
					<div v-if="data.message">
						<div class="panel userPanel">
							<div class="panel-header">
								<div class="panel-control">
									<a class="blue">买家留言</a>
								</div>
							</div>
							<div class="panel-body">
								{{data.message}}
							</div>
						</div>
					</div>
					
					<div class="ticketInfo" v-if="data.invoiceType && data.invoiceType != 0">
						<div class="panel userPanel">
							<div class="panel-header">
								<div class="panel-control">
									<a class="blue">查看发票详情</a>
								</div>
								<h3 class="panel-title"><b>发票类型</b></h3>
							</div>
							<div class="panel-body">
								<table>
									<tr>
										<td width="33%">
											<label>发票类型：</label>
											<span v-if="data.invoiceType == 1">企业</span>
											<span v-if="data.invoiceType == 2">个人</span>
										</td>
										<td width="33%">
											<label>发票抬头：</label>
											<span>{{data.invoiceTitle}}</span>
										</td>
										<td>
											<label>发票内容：</label>
											<span>{{data.code}}</span>
										</td>
									</tr>
								</table>
							</div>
						</div>
					</div>
					<template v-if="data.state != 8">
					<div class="expressInfo">
						<div class="panel userPanel">
							<div class="panel-header">
								<div class="panel-control">
									<a :orderId="data.orderNumber" class="blue expressOrderBtn1">查看物流</a>
								</div>
								<h3 class="panel-title"><b>我的物流信息</b></h3>
							</div>
							<div class="panel-body">
								<table>
									<tr>
										<td width="33%">
											<label>快递公司：</label>
											<span v-if="data.orderExpressOut">{{data.orderExpressOut.expressCompany}}</span>
										</td>
										<td width="33%">
											<label>快递单号：</label>
											<span v-if="data.orderExpressOut">{{data.orderExpressOut.expressNum}}</span>
										</td>
										<td>
											<label>时间：</label>
											<span v-if="data.orderExpressOut">{{data.orderExpressOut.createTime}}</span>
										</td>
									</tr>
								</table>
							</div>
						</div>
					</div>
					</template>
					
				</div>
				
			</div>
		</div>
	</div>
	
	<%- include ../userFooter.ejs %>
	
<%- include exchange_swap_common.ejs %>	
<%- include swapCommonJs.ejs %>	
<script>
var routerVm = new Vue({
	el: "#router"
})

$(".userLeftNav li[data-target='exchange'] li:eq(5)").addClass("cur");

var id = utils.getUrlParam("id");
var swapType = 2;

var detailVm = new Vue({
	el: "#orderDetail",
	data: {
		data: {}
	},
	mounted: function(){
		var self = this;
		utils.ajax({
			url: "/api/order/swap/info/"+id + "/" + swapType,
			type:"get",
			success: function(data){
				data = data.data;
				self.data = data;
				if(data.state == 41){
					$("#orderProgress li:eq(1)").prevAll().addClass("cur")
				}else if(data.state == 42){
					$("#orderProgress li:eq(2)").prevAll().addClass("cur")
				}else if(data.state == 45){
					$("#orderProgress li:eq(3)").prevAll().addClass("cur")
				}else if(data.state == 48){
					$("#orderProgress li:eq(4)").prevAll().addClass("cur")
				}else if(data.swapinState == 49 && data.swapoutState == 50){
					$("#orderProgress li:eq(5)").prevAll().addClass("cur")
				}
			}
		})
	},
	filters: {
		formatImg: function(str){
			return utils.formatImg(str);
		}
	}
})

$(document).on("click", ".cancelOrderBtn", function(e){
	//取消订单
	var self = $(e.currentTarget)
	var id = self.attr("orderNumber")
	cancelOrder(id, swapType, function(){
		utils.alert("success", "取消成功");
		$("#orderNav li.cur").trigger("click");
	})
	
}).on("click", ".sendOrderBtn", function(e){
	//发货
	var self = $(e.currentTarget)
	var id = self.attr("orderNumber");
	sendOrder(id, swapType, function(data){
		utils.alert("success", "操作成功");
		$("#orderNav li.cur").trigger("click");
	})
}).on("click", ".receiveOrderBtn", function(e){
	//确认收货
	var self = $(e.currentTarget)
	var id = self.attr("orderNumber");
	receiveOrder(id, swapType, function(data){
		utils.alert("success", "操作成功");
		$("#orderNav li.cur").trigger("click");
	})
})
</script>

</body>
</html>

