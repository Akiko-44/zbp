<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv='X-UA-Compatible' content='IE=Edge,chrome=1' />
  <meta name="renderer" content="webkit">
  <meta name="description" content="中宝协云平台-中国珠宝行业垂直云平台，聚集珠宝爱好者！最新珠宝新资讯，商品涵盖钻石、黄金、彩宝、翡翠玉石、珍珠琥珀等珍贵材质、独特设计、给您精致奢华精彩呈现。！">
  <meta name="keywords"
    content="中宝协云平台、中宝云、中宝平、珠宝圈、珠宝定制、珠宝鉴定、珠宝品牌、钻石戒指、玉石闲 置、珠宝直播、珠宝拍卖、珠宝行业、珠宝证书、求婚钻戒、彩宝、珠宝商城、珠宝首饰、珠宝展、珠宝设计、珠宝市场、珠宝图片、世界珠宝、钻戒定制、首饰、珠宝店、珠宝真品、黄金/K金及首饰、银饰及首饰、天然钻石及首饰、翡翠、和田玉、彩色宝石、珍珠、水晶、琥珀、黄龙玉、绿松石、玛瑙、印章石、其他玉石及首饰、贵金属（除黄金、K金、白银）首饰 、有机宝石（除珍珠、琥珀）、培育钻石及首饰、珠宝一站式购物商城、品牌珠宝、买首饰、珠宝商城、专业珠宝、珠宝鉴定、最权威的珠宝鉴定网站、珠宝科普、钻石怎么买、什么是5G黄金、什么是千足金、翡翠鉴定、玉石变色的原因、海水珍珠怎么鉴别、爱迪生珍珠、什么是海蓝宝、什么是铂金、怎么计算钻石价格">
  <title><%= title %></title>
  <link rel="shortcut icon" type="image/x-icon" href="http://app.gacjc.com/app/download/favicon.ico" />
  <link rel="bookmark" type="image/x-icon" href="http://app.gacjc.com/app/download/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_718775_m854kdemp1s.css" />
  <link rel="stylesheet" type="text/css" href="../../src/css/sprite.css" />
  <link rel="stylesheet" type="text/css" href="../../dist/css/all.css" />
  <link rel="stylesheet" type="text/css" href="../../src/js/vue/index.css" />
  <script src="../../dist/js/template.js"></script>
  <script src="../../dist/js/lib.js"></script>
  <script src="../../dist/js/v.js"></script>
  <style>
    .userRightContent {
      padding: 30px 20px 40px;
      margin-bottom: 20px;
      background: #fff;
      font-size: 14px;
    }

    .auditState-info {
      margin-bottom: 20px;
      padding: 20px;
      background: #f7f7f7;
      color: #aaa;
      font-size: 12px;
      line-height: 30px;
    }

    .refund-state-text {
      font-size: 14px;
      color: #333;
    }

    .goods-info {
      margin-top: 20px;
      padding: 0 66px 0 20px;
      color: #666;
      font-size: 12px;
      border: 1px solid #dedede;
    }

    .goods-info .shop-name {
      line-height: 34px;
      font-size: 16px;
    }

    .goods-info .select-item {
      margin-top: 40px;
    }

    .goods-info img {
      width: 100px;
      height: 100px;
    }

    .goods-info .el-row {
      padding-bottom: 12px;
    }

    .goods-name {
      margin: 20px 0;
      font-size: 16px;
    }

    .goods-sku {
      font-size: 12px;
      color: #aaa;
    }

    .goods-count {
      margin-top: 40px;
    }

    .goods-total {
      margin-top: 30px;
      margin-bottom: 10px;
    }

    .price {
      color: #FB746E;
    }

    .rufund-info {
      margin: 20px 0;
      padding: 10px 20px;
      color: #333;
      line-height: 30px;
      background: #F7F7F7;
    }

    .refund-reason .title {
      color: #666666;
      line-height: 36px;
    }

    .refund-reason .body {
      padding: 20px;
      background: #f3f3f3;
    }

    /* .image-tip {
      color: #999;
      font-size: 12px;
      line-height: 40px;
    } */

    /* .submit {
      margin-top: 60px;
      width: 376px;
      height: 50px;
      background: #DF735A;
      border-radius: 0;
    } */

    /* .el-checkbox__input.is-checked .el-checkbox__inner {
      background: #DF735A;
      border-color: #DF735A;
    }

    .el-checkbox__input.is-focus .el-checkbox__inner,
    .el-checkbox__inner:hover {
      border-color: #DF735A;
    } */

    .arbitrate-info {
      padding-top: 30px;
      border-top: 1px solid #dedede;
    }

    .detail-info {
      padding: 20px 0;
      color: #666;
      font-size: 14px;
      line-height: 50px;
    }

    .detail-info .detail-value {
      font-size: 12px;
    }

    .detail-info .detail-img {
      width: 80px;
      height: 80px;
    }

    .operation-box {
      text-align: center;
    }

    .operation-box p,
    .operation-box div {
      display: inline-block;
    }

    .operation-box .btn {
      margin-left: 10px;
      width: 123px;
      line-height: 36px;
      border: 1px solid #dedede;
    }

    .operation-box .btn-warning {
      color: #fff;
      background: #D57E6A;
      border-color: #D57E6A;
    }
  </style>
</head>

<body class="userOrderJewelry">

  <%- include ../../headerbar.ejs %>

  <%- include ../userHeaderNav.ejs %>

  <div class="container">
    <div class="router" id="router">
      <el-breadcrumb separator-class="el-icon-arrow-right">
        <el-breadcrumb-item>
          <a href="/">首页</a>
        </el-breadcrumb-item>
        <el-breadcrumb-item :to="{ path: '/' }">
          <a href="/user/acc_info">个人中心</a>
        </el-breadcrumb-item>
        <el-breadcrumb-item :to="{ path: '/' }">
          <a href="/user/order/refund">售后订单</a>
        </el-breadcrumb-item>
        <el-breadcrumb-item>服务详情</el-breadcrumb-item>
      </el-breadcrumb>
    </div>
  </div>

  <div id="main" class="main">
    <div class="clearfix container">
      <div class="userLeftNav">
        <%- include ../userLeftNav.ejs %>
      </div>
      <div class="userRightContent">

        <div id="orderDetail" v-cloak>

          <div class="auditState-info">
            <p class="refund-state-text">{{refundStateText}}</p>
            <p class="refund-text-info">{{refundTextInfo}}</p>
          </div>

          <h3 class="detail-title">退款信息</h3>
          <div class="goods-info" v-for="item in data.revoList">
            <div class="shop-name">{{data.sellUserName}}</div>
            <el-row>
              <el-col :span="4">
                <img :src="item.skuMainPic | formatImg" alt="">
              </el-col>
              <el-col :span="8">
                <div class="goods-name">{{item.skuName}}</div>
                <span class="goods-sku" v-for="(subItem,subI) in item.skuExplain">
                  <span>{{subItem.specsName}}</span>
                  <span>：</span>
                  <span>{{subItem.attrValue}}</span>
                  <span v-if="subI !== item.skuExplain.length-1">&nbsp;&nbsp;;&nbsp;&nbsp;</span>
                </span>
              </el-col>
              <el-col :span="4" class="tc">
                <div class="goods-count">单价：￥{{item.unitPrice}}</div>
              </el-col>
              <el-col :span="4" class="tc">
                <div class="goods-count">数量：{{item.goodsNumber}}</div>
              </el-col>
              <el-col :span="4" class="tr">
                <div class="goods-count">总价：<span class="price">￥{{item.unitPrice * item.goodsNumber}}</span></div>
              </el-col>
            </el-row>
          </div>

          <div class="detail-info">
            <div class="detail-item">
              <span class="detail-label">退款编号：</span>
              <span class="detail-value">{{ data.orderNumber }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">申请时间：</span>
              <span class="detail-value">{{ data.createTime }}</span>
            </div>
            <div class="detail-item" v-if="data.refundAmount">
              <span class="detail-label">退款金额：</span>
              <span class="detail-value">{{ data.refundAmount.toFixed(2) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">退款原因：</span>
              <span class="detail-value">{{ data.comment }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">退款凭证：</span>
              <img class="detail-img" v-for="pic in data.picList" :src="pic" alt="退款凭证">
            </div>
          </div>

          <div class="arbitrate-info"
            v-if="data.auditState === 7 || data.auditState === 8 || data.auditState === 9 ||data.auditState === 10">
            <h3 class="detail-title">仲裁信息</h3>
            <div class="detail-info">
              <div class="detail-item">
                <span class="detail-label">申请时间：</span>
                <span class="detail-value">{{data.arbitrationTime}}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">申请原因：</span>
                <span class="detail-value">{{ data.arbitationReason }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">仲裁凭证：</span>
                <img class="detail-img" v-for="pic in data.arbitrationPic" :src="pic" alt="仲裁凭证">
              </div>
            </div>
          </div>

          <div class="arbitrate-info" v-if="data.arbitrationLogList && data.arbitrationLogList.length">
            <h3 class="detail-title">仲裁处理</h3>
            <div class="detail-info">
              <div class="detail-item">
                <span class="detail-label">仲裁人员：</span>
                <span class="detail-value">{{ data.arbitrationLogList[0].auditName }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">处理时间：</span>
                <span class="detail-value">{{data.arbitrationLogList[0].createTime}}</span>
              </div>
            </div>
          </div>

          <div class="operation-box">
            <!-- <p><a class="btn toRefundDetail">售后详情</a></p> -->
            <!-- <p class="btn refuseBtn" v-if="data.auditState == 6" @click="refuseBtn(index)">查看拒绝原因</p> -->
            <p v-if="(data.auditState === 0) && (data.refundType === 1)">
              <a class="btn revokeCancelBtn" refundType="1" :orderId="data.orderRefundId">撤销退款</a>
            </p>
            <p
              v-if="(data.auditState === 0 || data.auditState === 1 || data.auditState === 8) && (data.refundType === 2)">
              <a class="btn revokeCancelBtn" refundType="1" :orderId="data.orderRefundId">撤销退货</a>
            </p>
            <p v-if="data.auditState === 2"><a class="expressOrderBtn btn" :orderId="data.orderId"
                :orderNumber="data.orderNumber">查看物流</a>
            </p>
            <a v-if="(data.auditState === 1 || data.auditState === 8) && (data.refundType === 2)"
              class="btn btn-warning refundBtn" :data-id="data.orderRefundId"
              :data-sellUserId="data.sellUserId">寄回商品</a>
            <!--<button class="btn btn-info getRefundAddrBtn" v-if="data.auditState == 1" :selluserid="data.sellUserId">查看退货地址</button>-->
            <a class="btn btn-warning" @click="applyArbitrate(data.orderRefundId, data.orderNumber)"
              v-if="data.auditState === 6 || data.auditState === 11">申请仲裁</a>
          </div>

        </div>
      </div>
    </div>
  </div>

  <%- include ../../footer.ejs %>

  <%- include commonJs.ejs %>

  <form id="form1" class="hide" method="post" enctype="multipart/form-data">
    <input type="file" name="cloudfile" accept="image/*" onchange="uploadGoodsImg(this)">
  </form>
  <script>
    $(".userLeftNav li[data-target='refund']").addClass("cur");

    var routerVm = new Vue({
      el: "#router"
    })

    var id = utils.getUrlParam("id");

    var detailVm = new Vue({
      el: "#orderDetail",
      data: {
        data: {},
        active: 1,
        refundState: g_const.refundState,
        refundStateText: '',
        refundTextInfo: '',
      },
      mounted: function () {
        // var self = this;
        utils.ajax({
          url: "/api/order/refund/info/" + id,
          type: "get",
          success: (data) => {
            this.data = data.data;
            this.refundStateText = this.refundState[this.data.auditState]
            switch (this.data.auditState) {
              case 0:
                this.refundStateText = this.data.refundType === 2 ? "您已成功发起退货申请" : "您已成功发起退款申请"
                this.refundTextInfo = "请耐心等待商家处理"
                break
              case 1:
                this.refundStateText = this.data.refundType === 2 ? "商家同意退货" : "商家同意退款"
                break;
              case 2:
                this.refundStateText = "您已成功寄回商品"
                this.refundTextInfo = "请耐心等待商家确认收货"
                break
              case 3:
                this.refundStateText = this.data.refundType === 2 ? "退货成功" : "退款成功"
                this.refundTextInfo = "退款金额 ¥" + this.data.refundAmount + "已原路返回"
                break
              case 4:
                this.refundStateText = this.data.refundType === 2 ? "平台拒绝退货" : "商家拒绝了退款申请"
                this.refundTextInfo = this.data.refundType === 2 ? "原因:请耐心等待平台处理" : "原因:请耐心等待商家处理"
                break;
              case 5:
                this.refundStateText = "您已撤销退款/货申请"
                break;
              case 6:
                this.refundStateText = this.data.refundType === 2 ? "商家拒绝退货" : "商家拒绝退款"
                if (this.data.auditLogList.length) {
                  this.refundTextInfo = "原因:" + this.data.auditLogList[0].opinion
                }
                break;
              case 7:
                this.refundStateText = this.data.refundType === 2 ? "退货仲裁中" : this.data.arbitrationType ===
                  1 ? "您已成功发起退款仲裁申请" : "商家成功发起退款仲裁申请"
                this.refundTextInfo = "请耐心等待平台工作人员处理"
                break
              case 8:
                this.refundStateText = this.data.refundType === 2 ? "平台同意退货" : "退款成功"
                if (this.data.refundType === 1) {
                  this.refundTextInfo = "退款金额 ¥" + this.data.refundAmount + "已原路返回"
                }
                break
              case 9:
                this.refundStateText = this.data.refundType === 2 ? "平台拒绝退货" : "平台拒绝了退款申请"
                if (this.data.refundType === 1) {
                  if (this.data.arbitrationLogList.length) {
                    this.refundTextInfo = "原因:" + this.data.arbitrationLogList[0].opinion
                  }
                } else {
                  if (this.data.auditLogList.length) {
                    this.refundTextInfo = "原因: " + this.data.auditLogList[0].opinion
                  }
                }
                break
              case 10:
                this.refundStateText = "仲裁退回"
                if (this.arbitrationLogList.length) {
                  this.refundTextInfo = "原因:" + this.data.arbitrationLogList[0].opinion
                }
                break
              case 11:
                this.refundStateText = "商家拒绝收货"
                if (this.data.auditLogList.length) {
                  this.refundTextInfo = "原因:" + this.data.auditLogList[0].opinion
                }
                break
              case 12:
                this.refundStateText = "退货仲裁中"
                this.refundTextInfo = "请耐心等待平台工作人员处理"
                break
              case 13:
                this.refundStateText = this.data.refundType === 2 ? "商家拒绝退货" : "商家拒绝退款"
                if (this.data.auditLogList.length) {
                  this.refundTextInfo = "原因:" + this.data.auditLogList[0].opinion
                }
                break
              case 14:
                this.refundStateText = "商家拒绝收货"
                if (this.data.auditLogList.length) {
                  this.refundTextInfo = "原因:" + this.data.auditLogList[0].opinion
                }
                break
            }
          }
        })
      },
      methods: {

      },
      filters: {
        formatImg: function (str) {
          return utils.formatImg(str);
        }
      }
    })
    $(document).on("click", ".toRefundDetail", function (e) {
      var self = $(e.currentTarget);
      var id = self.parents("li").attr("data-id");
      location.href = "/user/order/refund_detail?id=" + id;
    }).on("click", ".toCancelRefund", function (e) {
      var self = $(e.currentTarget);
      var id = self.parents("li").attr("data-id");
      utils.ajax({
        url: "/api/order/refund/cancel/" + id,
        success: function (data) {
          if (data.success) {
            location.reload();
          } else {
            utils.alert("danger", data.msg)
          }
        }
      })
    }).on("click", ".refundBtn", function (e) {
      var self = $(e.currentTarget);
      var id = self.attr('data-id');
      var sellUserId = self.attr('data-sellUserId');
      location.href = "/user/order/returnGoods_apply?id=" + id + "&sellUserId=" + sellUserId
    }).on("click", ".save", function () {
      // 寄回商品
      if (validform.check(false)) {
        var str = $("#refundAddr form").serialize();
        str = utils.str2json(str);
        utils.ajax({
          url: "/api/refund/express/save",
          data: JSON.stringify(str),
          success: function (data) {
            utils.alert('success', '提交成功')
            setTimeout(function () {
              location.reload()
            }, 1000)
          }
        })
      }
    }).on("click", ".getRefundAddrBtn", function (e) {
      var self = $(e.currentTarget);
      var selluserid = self.attr('selluserid');
      utils.ajax({
        type: 'get',
        url: "/api/order/refundAddr/" + selluserid,
        success: function (data) {
          data = data.data;
          $("#addr").text(data.addr);
          $("#consignee").text(data.consignee);
          $("#mobileNum").text(data.mobileNum);
          setTimeout(function () {
            $("#refundAddrLook").addClass('show')
          }, 100)
        }
      })
    })
  </script>

</body>

</html>