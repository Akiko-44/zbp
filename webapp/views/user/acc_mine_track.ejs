<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv='X-UA-Compatible' content='IE=Edge,chrome=1' />
  <meta name="renderer" content="webkit">
  <meta name="description" content="中宝协云平台-中国珠宝行业垂直云平台，聚集珠宝爱好者！最新珠宝新资讯，商品涵盖钻石、黄金、彩宝、翡翠玉石、珍珠琥珀等珍贵材质、独特设计、给您精致奢华精彩呈现。！">
  <meta name="keywords"
    content="中宝协云平台、中宝云、中宝平、珠宝圈、珠宝定制、珠宝鉴定、珠宝品牌、钻石戒指、玉石闲 置、珠宝直播、珠宝拍卖、珠宝行业、珠宝证书、求婚钻戒、彩宝、珠宝商城、珠宝首饰、珠宝展、珠宝设计、珠宝市场、珠宝图片、世界珠宝、钻戒定制、首饰、珠宝店、珠宝真品、黄金/K金及首饰、银饰及首饰、天然钻石及首饰、翡翠、和田玉、彩色宝石、珍珠、水晶、琥珀、黄龙玉、绿松石、玛瑙、印章石、其他玉石及首饰、贵金属（除黄金、K金、白银）首饰 、有机宝石（除珍珠、琥珀）、培育钻石及首饰、珠宝一站式购物商城、品牌珠宝、买首饰、珠宝商城、专业珠宝、珠宝鉴定、最权威的珠宝鉴定网站、珠宝科普、钻石怎么买、什么是5G黄金、什么是千足金、翡翠鉴定、玉石变色的原因、海水珍珠怎么鉴别、爱迪生珍珠、什么是海蓝宝、什么是铂金、怎么计算钻石价格">
  <title>
    <%= title %>
  </title>
  <link rel="shortcut icon" type="image/x-icon" href="http://app.gacjc.com/app/download/favicon.ico" />
  <link rel="bookmark" type="image/x-icon" href="http://app.gacjc.com/app/download/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_718775_m854kdemp1s.css" />
  <link rel="stylesheet" type="text/css" href="../../src/css/sprite.css" />
  <link rel="stylesheet" type="text/css" href="../../dist/css/all.css" />
  <link rel="stylesheet" type="text/css" href="../../src/js/vue/index.css" />
  <script src="../../dist/js/template.js"></script>
  <script src="../../dist/js/lib.js"></script>
  <script src="../../dist/js/v.js"></script>
  <link rel="stylesheet" type="text/css"
    href="../../src/js/plugin/Zebra_Datepicker/dist/css/metallic/zebra_datepicker.min.css" />
</head>
<style>
  .userRightContent {
    background: #F3F3F3;
  }

  .my-foot {
    background: #fff;
  }

  .edit-btn {
    margin-left: 20px;
    cursor: pointer;
  }

  .collect_head {
    margin-left: 20px;
    margin-right: 20px;
    line-height: 80px;
    height: 80px;
    font-size: 16px;
    color: #333333;
  }

  .collectitem {
    position: relative;
    margin: 9px;
    width: 215px;
    height: 237px;
    text-align: center;
    background: #FFFFFF;
    border: 2px solid rgba(246, 246, 246, 1);
  }

  .collectitem.editItem {
    border-color: #DF735A;
  }

  .collectitem.noEditItem {
    border-color: #AAA;
  }

  .goods_img {
    height: 129px;
    margin-top: 23px;
    margin-bottom: 16px;
  }

  .goods_name {
    padding: 0 22px;
    color: #333333;
    font-size: 14px;
  }

  .goods_price {
    margin-top: 10px;
    color: #FB746E;
    font-size: 12px;
  }

  .classifity {
    color: #999999;
    font-size: 14px;
    margin-left: 20px;
  }

  .classifity_item {
    margin-right: 10px;
  }

  .el-radio__input {
    display: none;
  }

  .el-radio+.el-radio {
    margin-left: 0;
  }

  .el-radio__input.is-checked+.el-radio__label {
    color: #FB746E;
  }

  .goods_edit {
    /* float: right; */
    position: absolute;
    bottom: -1px;
    right: -1px;
    cursor: pointer;
  }

  .page-pagination {
    padding: 40px 0 80px;
  }
</style>

<body class="userAccount">

  <%- include ../headerbar.ejs %>
  <%- include userHeaderNav.ejs %>

  <div class="container">
    <div class="router" id="router">
      <el-breadcrumb separator-class="el-icon-arrow-right">
        <el-breadcrumb-item>
          <a href="/">首页</a>
        </el-breadcrumb-item>
        <el-breadcrumb-item>
          <a href="/user/acc_info">个人中心</a>
        </el-breadcrumb-item>
        <el-breadcrumb-item>我的足迹</el-breadcrumb-item>
      </el-breadcrumb>
    </div>
  </div>

  <div id="main" class="main" style="background: #f4f4f4" v-cloak>
    <div class="clearfix container">
      <div class="userLeftNav">
        <%- include userLeftNav.ejs %>
      </div>
      <div class="userRightContent" style="height: 100%">

        <div class="my-foot">
          <div class="collect_head">
            <span class="fl">我的足迹</span>
            <template v-if="isEdit">
              <span class="edit-btn blue fr" @click="goodsEidt(1,$event)">删除</span>
              <span class="edit-btn blue fr" @click="isEdit = false">取消</span>
              <!-- <span class="edit-btn blue fr" v-if="!allEdit" @click="checkAll">全选</span> -->
              <!-- <span class="edit-btn blue fr" v-if="allEdit" @click="checkAll">全不选</span> -->
            </template>
            <span v-else class="edit-btn blue fr" @click="goodsEidt(2, $event)">编辑</span>
          </div>
          <div style="height: 10px;background: #F3F3F3;"></div>
          <div style="height: 60px;background: #fff;line-height: 60px;">
            <el-radio-group v-model="radio" @change="getList">
              <el-radio label="分类：" disabled></el-radio>
              <el-radio label="">全部商品</el-radio>
              <el-radio v-for="(item,i) in category" :label="item.id" :key="i">{{item.catName}}</el-radio>
            </el-radio-group>

          </div>
          <div class="clearfix" style="background: #fff;padding: 10px;">
            <div class="collectitem fl"
              :class="{'editItem' : isEdit && item.isEdit, 'noEditItem' : isEdit && !item.isEdit }"
              v-for="(item,i) in page" @click="toGoodsDetails(item.id)">
              <img class="goods_img" :src="item.imgUrl" alt="">
              <p class="goods_name ellipsis">{{item.goodsName}}</p>
              <p class="goods_price">¥{{utils.keepTwoDecimalFull(item.price)}}</p>
              <img v-if="isEdit && item.isEdit" class="goods_edit" src="../../src/img/user/icon_edit.png"
                @click.stop="chooseEdit(item.isEdit,i)" />
              <img v-if="isEdit && !item.isEdit" class="goods_edit" src="../../src/img/user/icon_noEdit.png"
                @click.stop="chooseEdit(item.isEdit,i)" />

            </div>
          </div>
        </div>

        <div class="page-pagination" v-if="pages>1">
          <el-pagination class="tc list-pagination" background @current-change="handleCurrentChange"
            :current-page="params.offset" :page-size="params.limit" layout="prev, pager, next, jumper" :total="total">
          </el-pagination>
        </div>

      </div>

    </div>
  </div>

  <%- include ../footer.ejs %>

</body>
<script>
  $(".userLeftNav li[data-target='track']").addClass("cur");
  var routerVm = new Vue({
    el: "#router"
  })
  var applyVm = new Vue({
    el: "#main",
    data: {
      isEdit: false,
      allEdit: false,
      radio: '',
      category: [{
        catName: '',
        id: ''
      }],
      params: {
        limit: 10,
        offset: 1,
        categoryId: undefined
      },
      total: 0,
      pages: 0,
      page: []
    },
    mounted() {
      this.getAllList()
    },
    methods: {
      getAllList() {
        utils.ajax({
          type: "get",
          url: "/api/userCenter/userFootprint",
          success: (res) => {
            this.category = res.data.category
            this.page = res.data.page.records
            this.total = res.data.page.total
            this.pages = res.data.page.total.pages
            this.page.map(item => {
              item.isEdit = false
            })
          }
        })
      },
      getList() {
        this.params.categoryId = this.radio == '' ? undefined : this.radio
        utils.ajax({
          type: "get",
          url: "/api/userCenter/userFootprint",
          data: this.params,
          success: (res) => {
            this.page = res.data.page.records
            this.total = res.data.page.total
          }
        })
      },
      handleCurrentChange(val) {
        this.params.offset = val
        this.getList()
      },
      checkAll() {
        this.allEdit = !this.allEdit
        this.page.map(item => {
          item.isEdit = this.allEdit
        })
      },
      chooseEdit(editStatus, index) {
        this.page.map(item => {
          item.isEdit = false
        })
        this.page[index].isEdit = !editStatus
        this.$forceUpdate()
      },
      toGoodsDetails(id) {
        location.href = "../jewelry/details?id=" + id
      },
      goodsEidt(config, e) {
        if (config !== 1) {
          this.page.map(item => {
            item.isEdit = false
          })
          this.isEdit = true
        } else {
          // let editList = []
          let json = {}
          this.page.map(item => {
            if (item.isEdit) {
              // editList.push(item.id)
              json.goodsIds = item.id
              json.goodsSource = item.goodsSource
            }
          })
          // const json = {
          // goodsIds: editList.join(',')
          // }
          utils.ajax({
            url: "/api/userCenter/deleteUserFootprint",
            type: 'get',
            data: json,
            el: e.target,
            success: (res) => {
              this.getAllList()
              this.isEdit = false
            }
          })
        }
      }
    }
  })
</script>

</html>