webpackJsonp([46],{"1AOO":function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.image[data-v-f23604c2] {\n  display: block;\n  max-width: 100%;\n  background-size: cover;\n  background-repeat: no-repeat;\n  background-position: center;\n}\n.danger[data-v-f23604c2] {\n  color: #F56C6C;\n}\n.el-col-6[data-v-f23604c2] {\n  margin-bottom: 20px;\n}\n",""])},Ivve:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("Xxa5"),i=a.n(r),n=a("exGp"),o=a.n(n),s=a("Oakg"),l=a("Iyuh"),c=a("r1st"),m=a("Q0Ca"),d=a("wJAk"),u={components:{ImageCropper:s.a,VCity:d.a},data:function(){return{currentIndex:1,disabled:!1,showStatus:[{name:"待展示",value:0},{name:"展示中",value:1},{name:"已过期",value:2}],cityShow:!1,citiesData:[],dateValue:"",pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-6048e5),t.$emit("pick",[a,e])}},{text:"最近一个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-2592e6),t.$emit("pick",[a,e])}},{text:"最近三个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-7776e6),t.$emit("pick",[a,e])}}]},prefix:"pic",width:1080,height:460,cropShow:!1,loading:!1,currentCropperName:"",editStatus:!0,airscapeLength:5,form:{id:void 0,name:void 0,merList:[],banner:void 0,provinceId:void 0,provinceName:void 0,cityId:void 0,cityName:void 0,airscapeList:[],showStatus:1,explain:void 0,labelList:[],startTime:void 0,endTime:void 0,grade:1},platformMerchants:[],notPlatformMerchants:[],rules:{banner:[{required:!0,message:"请上传头图",trigger:"blur"}],airscapeList:[{required:!0,message:"请上传鸟瞰图",trigger:"blur"}],name:[{required:!0,message:"请输入展会名称",trigger:"blur"}],explain:[{required:!0,message:"请输入展会简介",trigger:"blur"}],cityName:[{required:!0,message:"请选择展会地址并且填写详细地址",trigger:"change"}],address:[{required:!0,message:"请选择展会地址并且填写详细地址",trigger:"blur"}],endTime:[{required:!0,message:"请选择显示时间",trigger:"change"}],showStatus:[{required:!0,message:"请选择状态",trigger:"change"}],labelList:[{required:!0,message:"请选择分类标签",type:"array",trigger:"blur"}]}}},watch:{dateValue:function(t){this.form.startTime=t?t[0]:void 0,this.form.endTime=t?t[1]:void 0}},beforeRouteLeave:function(t,e,a){this.onbeforeunloadHandler(a)},beforeRouteEnter:function(t,e,a){var r=this;return o()(i.a.mark(function e(){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0,!t.query.id){e.next=6;break}return e.next=4,Object(l.b)(t.query.id).then(function(t){return t.data});case 4:"string"==typeof(n=e.sent).merList&&(n.merList=[]);case 6:a(function(t){setTimeout(function(){n&&(n.merList.forEach(function(e){e.merchantId&&"0"!==e.merchantId?t.platformMerchants.push(e):t.notPlatformMerchants.push(e)}),t.form=n,t.dateValue=[t.form.startTime,t.form.endTime])},10)});case 7:case"end":return e.stop()}},e,r)}))()},methods:{onbeforeunloadHandler:function(t){this.editStatus?window.confirm("确定要放弃当前的操作吗？")?t():t(!1):t()},resetForm:function(t,e){var a=this;this.$nextTick(function(){a.$refs[t].resetFields(),setTimeout(function(){e&&e()})})},save:function(){var t=this;this.$refs.form.validate(function(e){return e?t.notPlatformMerchants.filter(function(t){return t.merchantName&&t.logo}).length!==t.notPlatformMerchants.length?t.$message({message:"参展店铺：非平台商家，请填写商家名和上传Logo",type:"error",duration:5e3}):(t.loading=!0,t.form.merList=t.platformMerchants.concat(t.notPlatformMerchants),void Object(l.d)(t.form).then(function(e){t.editStatus=!1,t.$notify({title:"成功",message:"提交成功",type:"success",duration:2e3}),t.$router.push({name:"exhibitionPartnerList"}),t.loading=!1}).catch(function(){t.loading=!1})):(t.$notify({title:"警告",message:"请务必填写必选项",type:"warning"}),!1)})},cancel:function(){this.resetForm("form")},success:function(t){this.loading=!1,this.$emit("success",t)},uploadSuccess:function(t){var e=t.key;this.cropShow=!1,this.$refs.cropper.setStep(1),"airscape"!==this.currentCropperName?"banner"!==this.currentCropperName?"logo"===this.currentCropperName&&(this.notPlatformMerchants[this.currentIndex].logo=e):this.form[this.currentCropperName]=e:this.form.airscapeList.push({airscape:e,exhibitionId:this.$route.query.id})},cityChange:function(t){var e=this;[{name:"provinceName",id:"provinceId"},{name:"cityName",id:"cityId"}].forEach(function(a,r){e.form[a.name]=t[r]&&t[r].regionName,e.form[a.id]=t[r]&&+t[r].regionId})},showCrop:function(t,e,a){this.cropShow=!0,this.width=e,this.height=a,this.currentCropperName=t},isExist:function(t){var e=this,a=t.merchantId;a&&(this.disabled=!0,Object(c.a)(a).then(function(a){t.merchantName=a.data.merchantName,t.logo=a.data.logo,e.disabled=!1}).catch(function(t){e.$message({message:"参展店铺不存在，请重新输入",type:"error",duration:5e3})}))},addMerchant:function(t){t?this.platformMerchants.push({merchantId:void 0,merchantName:void 0,logo:void 0}):this.notPlatformMerchants.push({merchantName:void 0,logo:void 0})},getImageStyle:function(t){return{backgroundImage:"url("+Object(m.setImg)(t,{w:500})+")"}}}},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container",staticStyle:{"padding-right":"40px"}},[a("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"展会名称",prop:"name"}},[a("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"展会地址",prop:"cityName"}},[!t.form.id||t.cityShow?[a("v-city",{ref:"city",on:{change:t.cityChange}}),t._v(" "),a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"详细地址"},model:{value:t.form.address,callback:function(e){t.$set(t.form,"address",e)},expression:"form.address"}})]:t._e(),t._v(" "),t.form.id&&!t.cityShow?[a("span",[t._v(t._s(t.form.provinceName)+" "+t._s(t.form.cityName)+" "+t._s(t.form.address))]),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(e){t.cityShow=!0}}},[t._v("修改")])]:t._e()],2),t._v(" "),a("el-form-item",{attrs:{label:"开始-结束时间",prop:"endTime"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","picker-options":t.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},model:{value:t.dateValue,callback:function(e){t.dateValue=e},expression:"dateValue"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"头图",prop:"banner"}},[t.form.banner?a("el-card",{staticStyle:{width:"250px"},attrs:{"body-style":{padding:"0px"}}},[a("img",{staticClass:"image",attrs:{src:t._f("setImg")(t.form.banner),width:"100%"}}),t._v(" "),a("div",{staticStyle:{padding:"14px"}},[a("div",{staticClass:"bottom clearfix"},[a("el-button",{staticClass:"button",attrs:{type:"text"},on:{click:function(e){t.form.banner=""}}},[t._v("删除")])],1)])]):a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.showCrop("banner",600,400)}}},[t._v("上传")])],1),t._v(" "),a("el-form-item",{attrs:{label:"添加参展店铺"}},[a("el-form",{attrs:{"label-width":"0px"}},[a("el-form-item",[a("el-table",{staticStyle:{"margin-bottom":"10px"},attrs:{data:t.platformMerchants,border:""}},[a("el-table-column",{attrs:{label:"平台商家",align:"center"}},[a("el-table-column",{attrs:{align:"center",label:"商家ID"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"输入商家ID"},on:{blur:function(e){t.isExist(r)}},model:{value:r.merchantId,callback:function(e){t.$set(r,"merchantId",t._n(e))},expression:"row.merchantId"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"商家名"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("span",[t._v(t._s(r.merchantName||""))])]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"100px",align:"center",label:"logo"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return e.$index,[r.logo?a("el-card",{staticClass:"card",attrs:{"body-style":{padding:"0px"}}},[a("img",{staticClass:"image",staticStyle:{display:"block"},attrs:{src:t._f("setImg")(r.logo),width:"100%"}})]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"left",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){e.row;var r=e.$index;return[a("el-button",{staticClass:"button",attrs:{type:"text"},on:{click:function(e){t.platformMerchants.splice(r,1)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),a("el-button",{attrs:{size:"small",plain:"",type:"primary"},on:{click:function(e){t.addMerchant(!0)}}},[t._v("添加平台商家")])],1)],1),t._v(" "),a("br"),t._v(" "),a("el-form",{attrs:{"label-width":"0px"}},[a("el-form-item",[a("el-table",{staticStyle:{"margin-bottom":"10px"},attrs:{data:t.notPlatformMerchants,border:""}},[a("el-table-column",{attrs:{label:"非平台商家",align:"center"}},[a("el-table-column",{attrs:{align:"center",label:"商家名"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("el-input",{attrs:{placeholder:""},model:{value:r.merchantName,callback:function(e){t.$set(r,"merchantName",e)},expression:"row.merchantName"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"100px",align:"center",label:"logo"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row,i=e.$index;return[r.logo?a("el-card",{staticClass:"card",attrs:{"body-style":{padding:"0px"}}},[a("img",{staticClass:"image",staticStyle:{display:"block"},attrs:{src:t._f("setImg")(r.logo),width:"100%"}}),t._v(" "),a("div",{staticClass:"actions"},[a("el-button",{staticClass:"button",attrs:{icon:"el-icon-delete",type:"text"},on:{click:function(t){r.logo=""}}})],1)]):a("el-button",{attrs:{plain:"",size:"small"},on:{click:function(e){t.showCrop("logo",800,800),t.currentIndex=i}}},[t._v("上传")])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"left",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){e.row;var r=e.$index;return[a("el-button",{staticClass:"button",attrs:{type:"text"},on:{click:function(e){t.notPlatformMerchants.splice(r,1)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),a("el-button",{attrs:{size:"small",plain:"",type:"primary"},on:{click:function(e){t.addMerchant(!1)}}},[t._v("添加非平台商家")])],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"展会鸟瞰图",prop:"airscapeList"}},[a("el-row",{directives:[{name:"show",rawName:"v-show",value:t.form.airscapeList.length,expression:"form.airscapeList.length"}],staticClass:"row"},t._l(t.form.airscapeList,function(e,r){return a("el-col",{key:r,staticClass:"col",attrs:{span:6}},[a("el-card",{staticStyle:{width:"250px"},attrs:{"body-style":{padding:"0px"}}},[a("a",{staticClass:"image",staticStyle:{"min-height":"200px"},style:t.getImageStyle(e.airscape),attrs:{target:"_blank",href:t._f("setImg")(e.airscape)}}),t._v(" "),a("div",{staticStyle:{padding:"14px"}},[a("div",{staticClass:"bottom clearfix"},[a("el-button",{staticClass:"button",attrs:{type:"text"},on:{click:function(e){t.form.airscapeList.splice(r,1)}}},[t._v("删除")])],1)])])],1)})),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.form.airscapeList.length<t.airscapeLength,expression:"form.airscapeList.length < airscapeLength"}]},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.showCrop("airscape",1080,460)}}},[t._v("上传")]),t._v(" "),a("div",[t._v("共"),a("span",{staticClass:"danger"},[t._v(t._s(t.form.airscapeList.length))]),t._v("张，还能上传"),a("span",{staticClass:"danger"},[t._v(t._s(t.airscapeLength-t.form.airscapeList.length))]),t._v("张")])],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"会展简介",prop:"explain"}},[a("el-input",{attrs:{autosize:{minRows:3,maxRows:5},type:"textarea",placeholder:"请输入简介，不超过500字"},model:{value:t.form.explain,callback:function(e){t.$set(t.form,"explain",e)},expression:"form.explain"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"分类标签",prop:"labelList"}},[t._l(t.form.labelList,function(e,r){return a("div",{key:r,staticStyle:{"margin-bottom":"5px"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"标签内容"},model:{value:e.label,callback:function(a){t.$set(e,"label",a)},expression:"item.label"}}),t._v(" "),a("el-button",{attrs:{size:"small",type:"text",icon:"el-icon-delete",circle:""},on:{click:function(e){t.form.labelList.splice(r,1)}}})],1)}),t._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.form.labelList.push({label:""})}}},[t._v("添加")])],2),t._v(" "),a("el-form-item",[a("el-button",{attrs:{disabled:t.disabled,type:"primary",loading:t.loading},on:{click:t.save}},[t._v("提交")])],1)],1),t._v(" "),a("ImageCropper",{ref:"cropper",attrs:{noCircle:!0,noSquare:!0,withCredentials:!0,imgFormat:"jpg",width:t.width,height:t.height,prefix:t.prefix},on:{"crop-upload-success":t.uploadSuccess},model:{value:t.cropShow,callback:function(e){t.cropShow=e},expression:"cropShow"}})],1)},staticRenderFns:[]};var f=a("VU/8")(u,p,!1,function(t){a("sXfm")},"data-v-f23604c2",null);e.default=f.exports},r1st:function(t,e,a){"use strict";e.a=function(t){return Object(r.a)({url:"/admin/extend/exhibition/getMerchantInfo",method:"get",params:{merchantId:t}})};var r=a("vLgD")},sXfm:function(t,e,a){var r=a("1AOO");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);a("rjj0")("09a3a9ac",r,!0)}});